var superbook=function(exports){var version='0.0.1';var root=this;var previous_superbook=root.superbook;function noConflict(){root.superbook=previous_superbook;return this;}function noop(){}function isFunction(mixed){return typeof(mixed)=='function';}function isObject(mixed){var res=mixed!==null&&typeof mixed=='object';if(res)res=!_.isEmpty(mixed);return res;}function isArray(mixed){return mixed instanceof Array&&mixed.length>0;}function inArray(value,array,i){var len;if(array){if(array.indexOf){return array.indexOf.call(array,value,i);}len=array.length;i=i?i<0?Math.max(0,len+i):i:0;for(;i<len;i++){if(i in array&&array[i]===value){return i;}}}return-1;}var _connects={};function connectCreate(name){return new Connect(name);}function connectGet(name,debug){function getIt(name,debug){if(name){if(debug)return _connects[name];return _connects[name].connect;}else{var obj={};_.each(_connects,function(value,key){if(debug){obj[key]=_connects[key]}else{obj[key]=_connects[key].connect}});return obj;}}if(isArray(name)){var obj={};_.each(name,function(value,key){obj[value]=getIt(value,debug);});return obj;}else{return getIt(name,debug);}}function Connect(name){this._name=name;this._events={};this._availableEvents=['all','ok','cancel'];this.availablePermissions=[];this._permissions=[];this._user={};this._connect=function(){var that=this,FB=_sdks[this._name].sdk.FB;flow().seq(function(cb){if(FB)return cb();_sdks[that._name].sdk.init(function(err,Facebook){FB=Facebook;cb();});}).seq(function(cb){if(!_.isEmpty(that._user))return cb();FB.getLoginStatus(function(res){_.extend(that._user,{authResponse:res.authResponse,status:res.status});cb()});}).seq(function(cb){if(that._user.authResponse!==null)return cb();FB.login(function(res){_.extend(that._user,{authResponse:res.authResponse,status:res.status});cb();},{scope:that._permissions.join(',')});}).seq(function(cb){FB.api('/me',function(data){_.extend(that._user,data);cb();});}).exec(function(err,res){switch(that._user.authResponse){case null:if(that._events['cancel']){that._events['cancel'](null,that._user,FB);}break;default:if(that._events['ok']){that._events['ok'](null,that._user,FB);}break;}if(that._events['all']){that._events['all'](null,that._user,FB);}});};_connects[this._name]=this;return this;}Connect.prototype.end=function(){_connects[this._name]=this;_.extend(_connects[this._name],{connect:{name:this._name,user:this._user,connect:this._connect}});this._connect();return _connects[this._name].connect;};Connect.prototype.ask=function(mixed){var that=this;if(arguments.length>1){_.each(arguments,function(value,key){that.ask(value);});}else{if(isArray(mixed)){_.each(mixed,function(value,key){that.ask(value);});}else{if(inArray(mixed,this._permissions)===-1){this._permissions.push(mixed);}}}return this;};Connect.prototype.on=function(mixed,callback){var that=this;if(isArray(mixed)){_.each(mixed,function(value,key){that.on(value);});}else if(isObject(mixed)){_.each(mixed,function(value,key){that.on(key,value);});}else{if(inArray(mixed,this._availableEvents)===-1){console.log('[error] Event `'+evt+'` is no valid connect event. '+'Valid events are: '+this._availableEvents.join(', ')+'.');return false;}if(callback){if(isFunction(callback)){this._events[mixed]=callback;}else{console.log('[error] Callback must be of type `function`.');}}else{return console.log('[error] Missing callback.');}}return this;};var _sdks={};function sdkCreate(name){return new Sdk(name);}function sdkGet(name,debug){function getIt(name,debug){if(name){if(debug)return _sdks[name];return _sdks[name].sdk;}else{var obj={};_.each(_sdks,function(value,key){if(debug){obj[key]=_sdks[key]}else{obj[key]=_sdks[key].sdk}});return obj;}}if(isArray(name)){var obj={};_.each(name,function(value,key){obj[value]=getIt(value,debug);});return obj;}else{return getIt(name,debug);}}function Sdk(name){this._name=name||'FB';this._options={sdkUrl:'//connect.facebook.net/en_US/all.js',rootId:'fb-root'};this._FB=null;this._FB_init=false;this._FB_options={appId:null,cookie:true,logging:true,status:true,xfbml:false,oauth:true,channelUrl:'fb/channel.html',authResponse:'authResponse',frictionlessRequests:false,hideFlashCallback:null};this._load=function(callback){var that=this;function checkSDK(){return root.FB?true:false;}function checkRoot(){return($('#'+that.options.rootId).length>0);}function checkChannel(callback){superagent.get(that.FB_options.channelUrl).end(function(res){if(res.ok)return callback(null,true);callback(true,null);})}function createSDK(callback){Modernizr.load([{load:(that.options.sdkUrl),complete:function(){if(root.FB.init){that.FB=root.FB;callback(null,that.FB);}}}]);}function createRoot(){$(document.createElement('div')).attr('id',that.options.rootId).appendTo('body');return true;}if(this.FB){return callback(null,this.FB);}else{flow().seq(function(cb){if(checkSDK())return cb();createSDK(function(err){if(err){console.log('Could not load SDK from '+that.options.sdkUrl);}else{cb();}});}).seq(function(cb){if(checkRoot())return cb();createRoot();cb();}).seq(function(cb){if(checkChannel(function(err,res){if(err){console.log('[error] No channel file at '+that.FB_options.channelUrl+'found. '+'Add `channel.html` file to '+that.FB_options.channelUrl+' folder or '+'change location in `.create(..., {channelUrl : "/path/to/channel.html"})`.');return false;}else{return cb();}}));}).exec(function(err,res){if(callback)callback(err,that.FB);});}return this;};this._init=function(callback){var that=this;function checkSdk(){return that.FB;}function checkInit(){return that.FB_init;}function createInit(){that.FB.init(that.FB_options);that.FB_init=true;}if(checkInit())return callback(null,this.FB);if(checkSdk()){createInit();callback(null,this.FB);}else{flow().seq(function(cb){that.load(function(err){if(err)return console.log('Could not load SDK.');cb();});}).seq(function(cb){createInit();cb();}).exec(function(err,res){callback(null,that.FB);});}return this;};_sdks[this._name]=this;return this;}Sdk.prototype.end=function(){_sdks[this._name]=this;_.extend(_sdks[this._name],{sdk:{name:this._name,options:this._options,load:this._load,init:this._init,FB:this._FB,FB_init:this._FB_init,FB_options:this._FB_options}});return _sdks[this._name].sdk;};Sdk.prototype.id=function(id){this._FB_options.appId=id;return this;};Sdk.prototype.is=function(mixed,value){var that=this;if(isArray(mixed)){_.each(mixed,function(value,key){that.is(value);});}else if(isObject(mixed)){_.each(mixed,function(value,key){that.is(key,value);});}else{if(!this._FB_options.hasOwnProperty(mixed))return this;if(isFunction(value)){this._FB_options[mixed]=value();}else{this._FB_options[mixed]=value;}}return this;};var _uses={};function useCreate(name,callback){return new Use(name,callback);}function Use(name,callback){this._sdk=_sdks[name].sdk;this._sdk.init(function(err,FB){callback(err,FB);});}Use.prototype.end=noop;exports={version:version,noConflict:noConflict,sdks:{get:sdkGet},SDK:{create:sdkCreate},connects:{get:connectGet},Connect:{create:connectCreate},connect:connectCreate,create:sdkCreate,get:sdkGet,use:useCreate};return exports;}({});